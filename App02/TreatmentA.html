{{ block title }}
    Stage 2: Team Goals
{{ endblock }}

{{ block content }}
<!-- Chart.js fÃ¼r Radar Chart -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>

<style>
    .my-box {
        border: 1px solid #ccc;
        padding: 10px;
        background-color: #f9f9f9;
    }

    * {
        box-sizing: border-box;
    }

    .outer-container {
        width: 100%;
        height: 550px;
        display: flex;
    }

    .left-container {
        width: 60%;
        height: 100%;
        display: flex;
        overflow: auto;
        padding: 5px;
        flex-direction: column;
    }

    .right-container {
        width: 40%;
        height: 100%;
        padding: 20px;
        overflow-y: auto;
        font-family: Arial, sans-serif;
        font-size: 13px;

        display: flex;            /* Flexbox aktivieren */
        justify-content: center;  /* horizontal zentrieren */
        align-items: center;      /* vertikal zentrieren */
        text-align: center;       /* Text zentrieren, falls mehrzeilig */
    }

    .right-container h3 {
        margin-top: 15px;
        margin-bottom: 5px;
        font-size: 13px;
    }

    .right-container p {
        margin: 0 0 12px 0;
        font-size: 11px;
        line-height: 1.4;
    }

    #myRadarChart {
        width: 100% !important;
        height: 500px !important;
    }
</style>

<div class="my-box">
    <p>
        We matched you with two other participants. As before, the blue line shows how your video meeting goals look like in a multidimensional visualization.
        The red line now shows the average meeting goals of the other team members.
    </p>

    <div class="outer-container">
        <div class="left-container">
            <div id="radarChartContainer">
                <canvas id="myRadarChart"></canvas>
            </div>
        </div>

        <div class="right-container">
            Please take a moment to consider your goals and your team members goals.
        </div>
    </div>

    <br><br>
    <p><b>On the next page, you will have to wait until your two members are ready, before the video meeting starts </b>.</p>

    <script>
    const goalDescriptions = {{ session.vm_goal_description }};

    const customGridLinesPlugin = {
        beforeDraw(chart) {
            const ctx = chart.ctx;
            const scale = chart.scales['scale'];
            ctx.save();
            ctx.strokeStyle = '#ccc';
            ctx.lineWidth = 1;
            ctx.setLineDash([5, 5]);
            [-3, 0, 3].forEach(val => {
                const y = scale.getDistanceFromCenterForValue(val);
                ctx.beginPath();
                ctx.arc(scale.xCenter, scale.yCenter, y, 0, 2 * Math.PI);
                ctx.stroke();
            });
            ctx.restore();
        }
    };

    const customRadialLinesPlugin = {
        beforeDraw(chart) {
            const ctx = chart.ctx;
            const scale = chart.scales['scale'];
            const cx = scale.xCenter;
            const cy = scale.yCenter;
            ctx.save();
            ctx.strokeStyle = '#ccc';
            ctx.lineWidth = 1;
            ctx.setLineDash([5, 5]);
            const totalAxes = scale.pointLabels.length;
            for (let i = 0; i < totalAxes; i++) {
                const angle = scale.getIndexAngle(i) - Math.PI / 2;
                const rMin = scale.getDistanceFromCenterForValue(-3);
                const rMax = scale.getDistanceFromCenterForValue(3);
                ctx.beginPath();
                ctx.moveTo(cx + rMin * Math.cos(angle), cy + rMin * Math.sin(angle));
                ctx.lineTo(cx + rMax * Math.cos(angle), cy + rMax * Math.sin(angle));
                ctx.stroke();
            }
            ctx.restore();
        }
    };

    const customTickLabelsPlugin = {
        afterDraw(chart) {
            const ctx = chart.ctx;
            const scale = chart.scales['scale'];
            const cx = scale.xCenter;
            const cy = scale.yCenter;
            ctx.save();
            ctx.fillStyle = '#666';
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            const angle1 = scale.getIndexAngle(0) - Math.PI / 2;
            const angle2 = scale.getIndexAngle(1) - Math.PI / 2;
            const midAngle = (angle1 + angle2) / 2;
            [-3, 0, 3].forEach(val => {
                const r = scale.getDistanceFromCenterForValue(val) -10;
                const x = cx + r * Math.cos(midAngle);
                const y = cy + r * Math.sin(midAngle);
                ctx.fillText(val, x, y);
            });
            ctx.restore();
        }
    };


    function createRadarChart() {
        const ctx = document.getElementById('myRadarChart').getContext('2d');
        new Chart(ctx, {
            type: 'radar',
            data: {
                labels: {{ session.vm_goal_labels }},
                datasets: [
                    {
                        label: 'Your Own Goals',
                        data: js_vars.own,
                        backgroundColor: 'transparent',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 2,
                        pointBackgroundColor: 'rgba(54, 162, 235, 1)',
                        fill: false
                    },
                    {
                        label: 'Average Goals of Others',
                        data: js_vars.other,
                        backgroundColor: 'transparent',
                        borderColor: 'rgba(255, 99, 132, 1)',
                        borderWidth: 2,
                        pointBackgroundColor: 'rgba(255, 99, 132, 1)',
                        fill: false
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scale: {
                    ticks: {
                        min: -4,
                        max: 3,
                        stepSize: 1,
                        display: false
                    },
                    pointLabels: {
                        padding: 20,
                        fontSize: 12,
                        fontStyle: 'normal',
                        fontColor: '#666'
                        },
                    gridLines: { display: false },
                    angleLines: { display: false }
                },
                tooltips: {
                    callbacks: {
                        title(tip, data) {
                            return data.labels[tip[0].index];
                        },
                        label(tip) {
                            return goalDescriptions[tip.index];
                        }
                    }
                },
                hover: { mode: 'nearest', intersect: true },
                legend: {position: 'bottom', align: 'start', labels: {padding: 30}},
                title: {
                    display: true,
                    text: 'Video Meeting Goals',
                    fontSize: 18,
                    fontStyle: 'bold',
                    padding: 20
                }
            },

            plugins: [customGridLinesPlugin, customRadialLinesPlugin, customTickLabelsPlugin ]
        });
    }

    createRadarChart();
    </script>
</div>

<br/>
{{ next_button }}

{{ endblock }}
