{{ extends 'global/Page.html' }}
{{ block title }}Stage 2: Comprehension - Bonus Payoff 2{{ endblock }}

{{ block styles }}
    <style>
        .my-box {
            border: 1px solid #ccc;
            padding: 10px;
            background-color: #f9f9f9;
        }

        .selected:not(:first-child) {
            background-color: rgba(255, 0, 0, 0.6);
            font-weight: bolder;
            color: white !important;
            transition: background-color 0.3s ease;
        }

        .radio-group {
            display: flex;
            gap: 20px;
        }

        .formfields-inline {
            display: flex;
            gap: 20px; /* Abstand zwischen den Feldern */
            align-items: flex-end; /* Labels und Felder unten ausrichten */
        }

        .formfields-inline > div {
            flex: 1; /* alle gleich breit */
        }
    </style>
{{ endblock }}

{{ block content }}

    <div class="my-box">
        Please answer the comprehension questions on this page.
        <br><br>
        <b>Considering the following 3 scenarios, what would be your bonus payoff for Stage 2?</b>
        <div class="formfields-inline">
            {{ formfield 'comprehension1' }}
            {{ formfield 'comprehension2' }}
            {{ formfield 'comprehension3' }}
        </div>

        <b>What does your bonus payoff for Stage 2 depend on? Please select <u>all</u> applicable options.</b>
        <label><input type="checkbox" name="comprehension4a" class="form-check-input"/>&nbsp; &nbsp; Number of hours you work on the team project.</label>
        <br>
        <label><input type="checkbox" name="comprehension4b" class="form-check-input"/>&nbsp; &nbsp; Total number of hours worked by the team on the team project.</label>
        <br>
        <label><input type="checkbox" name="comprehension4c" class="form-check-input"/>&nbsp; &nbsp; Fewest number of hours worked by a member of your team on the team project.</label>
        <br><br>

        {{ if form.comprehension4a.errors }}
        <div class="alert alert-danger">
            {{ form.comprehension4a.errors.0 }}
        </div>
        {{ else }}
        {{ if form.comprehension4b.errors }}
        <div class="alert alert-danger">
            {{ form.comprehension4b.errors.0 }}
        </div>
        {{ else }}
        {{ if form.comprehension4c.errors }}
        <div class="alert alert-danger">
            {{ form.comprehension4c.errors.0 }}
        </div>
        {{ endif }}
        {{ endif }}
        {{ endif }}


    <h4 class="card-title text-center">Payoff Table</h4>
    {{ include_sibling 'PayoffTable.html' }}


    <b>Try out</b> the radio buttons. The radio button on this page will <u>not</u> affect your payoff:

    <div class="radio-group">
        <span><span style="color:  rgba(54, 162, 235, 1);">Your</span> contribution:</span>
        <label><input type="radio" name="choice" value="0"> 0 hour</label>
        <label><input type="radio" name="choice" value="10"> 10 hours</label>
        <label><input type="radio" name="choice" value="20"> 20 hours</label>
        <label><input type="radio" name="choice" value="30"> 30 hours</label>
        <label><input type="radio" name="choice" value="40"> 40 hours</label>
    </div>

</div>

<br/>
<div>
    <!-- Countdown-Hinweis -->
    <div id="countdown-container">
        <p style="color: gray; font-style: italic;">You can proceed in <span id="countdown-timer"></span> seconds.</p>
    </div>

    <!-- Next-Button erst nach Zeit -->
    <div id="next-container" style="display: none;">
        <p>{{ next_button }}</p>
    </div>
</div>

<script>
    const timeout_seconds = 10; // set minimum time

    document.addEventListener("DOMContentLoaded", function () {
        const countdownEl = document.getElementById("countdown-timer");
        let secondsLeft = timeout_seconds;

        // initial countdown-text
        countdownEl.textContent = secondsLeft;

        // update countdown
        const countdownInterval = setInterval(() => {
            secondsLeft -= 1;
            countdownEl.textContent = secondsLeft;

            if (secondsLeft <= 0) {
                clearInterval(countdownInterval);
                document.getElementById("countdown-container").style.display = "none";
                document.getElementById("next-container").style.display = "block";
            }
        }, 1000);
    });

    // Prevent page refresh (F5, Ctrl+R, Reload)
    document.addEventListener("keydown", function (e) {
        if ((e.key === "F5") || (e.ctrlKey && e.key === "r")) {
            e.preventDefault();
        }
    });
</script>

{{ endblock }}

{{ block scripts }}
<script>
document.addEventListener("DOMContentLoaded", function () {
    let row = document.querySelector("tbody").children[3];
    let rowA = Array.from(row.children);
    rowA.shift();

    function updateSelection(rowIndex) {
        rowA.forEach(el => el.classList.remove("selected"));
        row = document.querySelector("tbody").children[rowIndex];
        rowA = Array.from(row.children);
        rowA.shift();
        rowA.forEach(el => el.classList.add("selected"));
    }

    // Kein Highlight zu Beginn â€“ erst bei Auswahl

    const radios = document.querySelectorAll('input[name="choice"]');
    radios.forEach(radio => {
        radio.addEventListener("change", function () {
            switch (this.value) {
                case "0":
                    updateSelection(1);
                    break;
                case "10":
                    updateSelection(2);
                    break;
                case "20":
                    updateSelection(3);
                    break;
                case "30":
                    updateSelection(4);
                    break;
                case "40":
                    updateSelection(5);
                    break;
            }
        });
    });
});
</script>

{{ endblock }}
